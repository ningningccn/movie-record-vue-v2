import{V as j,W as B,r as n,w as I,o as C,a as i,c as u,G as T,X as P,b as s,Y as G,n as F,v as U,i as S,C as M,g as z,E as W,z as $,t as m,B as E,Z as K,I as A,L as J,x as R,J as O,F as X,d as Y,j as Z,$ as H}from"./index-RLflMxeX.js";import{L as Q}from"./loading-BeEcqM-A.js";const ee={class:"flex items-center"},te=s("i",{class:"icon-search text-[48px]"},null,-1),se={class:"w-[45px] overflow-hidden"},ae=s("i",{class:"icon-close text-[32px]"},null,-1),le=[ae],oe={__name:"search-input",props:{search:{},searchModifiers:{}},emits:j(["searchClick"],["update:search"]),setup(v,{emit:g}){const r=g,t=B(v,"search"),o=n(!1),a=n(null);I(()=>t.value,d=>{(d==null?void 0:d.length)>0?o.value=!0:o.value=!1});const _=()=>t.value="";return C(()=>{a.value.focus()}),(d,l)=>(i(),u("div",ee,[te,T(s("input",{type:"text",class:"text-body-xxl-medium w-full bg-transparent text-white placeholder:text-enable focus:outline-none md:ml-4",placeholder:"輸入關鍵字","onUpdate:modelValue":l[0]||(l[0]=c=>t.value=c),ref_key:"searchInputRef",ref:a,onKeyup:l[1]||(l[1]=G(c=>r("searchClick"),["enter"]))},null,544),[[P,t.value]]),s("div",se,[s("button",{type:"button",class:F(["flex items-center transition-transform duration-300",[{"translate-x-10":!o.value}]]),onClick:l[2]||(l[2]=c=>_())},le,2)]),s("button",{type:"button",onClick:l[3]||(l[3]=c=>r("searchClick")),class:"rounded-[8px] border px-4 py-2"}," Search ")]))}},ne={class:"skeleton-card relative aspect-[3/4.3] overflow-hidden rounded-[8px]"},re={alt:"",class:"absolute aspect-[3/4.3] size-full cursor-pointer object-cover"},ce={class:"absolute left-0 top-0",id:"card-watched-wrap"},ie={key:0,class:"text-body-s-medium rounded-[4px] bg-primary px-1 py-[2px] text-second"},ue={class:"mt-2 flex justify-between"},de={class:"text-body-m-medium"},pe=s("i",{class:"icon-heart pt-1"},null,-1),ve={class:"text-body-s-medium mt-1 flex justify-between text-enable"},he={class:"flex space-x-2"},fe={__name:"search-card",props:{id:{type:Number},title:{type:String,default:""},year:{type:String},poster:{type:String},date:{type:String},mediaType:{type:String}},emits:["getDataId"],setup(v,{emit:g}){const r=U(),t=v,o=S(()=>r.nameLists.some(b=>b===t.title)),a=S(()=>t.poster?`https://image.tmdb.org/t/p/w500${t.poster}`:""),_=S(()=>t.mediaType=="tv"?"電視劇":"電影"),d=M(),l=()=>{d.push({name:"searched",params:{mediaType:t.mediaType,mediaID:t.id}})},c=z.timeline(),p=()=>{c.fromTo("#card-watched-wrap",{x:-200},{x:0,delay:.5})};return C(async()=>{await p()}),(b,x)=>{const w=W("lazy");return i(),u("div",{class:"relative overflow-hidden",onClick:x[0]||(x[0]=D=>l())},[s("div",ne,[T(s("img",re,null,512),[[w,a.value]])]),s("div",ce,[o.value?(i(),u("div",ie," 已加入 ")):$("",!0)]),s("div",null,[s("div",ue,[s("div",de,m(v.title),1),pe]),s("div",ve,[s("div",he,m(_.value),1),s("div",null,m(v.date),1)])]),E(" "+m(o.value),1)])}}},ye={key:0,class:"flex-center h-full"},me={key:0,class:"text-body-xxl-medium flex items-center justify-center text-center text-enable",id:"no-result"},_e={key:1,class:"text-body-l mt-[60px] font-medium"},xe={key:2,class:"mt-10 grid grid-cols-12 gap-5"},we={__name:"search",setup(v){const g=M(),r=K(),t=n(!1),o=n(""),a=n([]),_=n(1),d=n(0),l=n(0),c=n(!1),p=n({include_adult:"false",language:"zh-TW",query:"",page:1}),b=async()=>{p.value.query=o.value,p.value.page=1,g.push({query:{q:o.value}}),a.value=[]};I(()=>p.value,async(h,f)=>{t.value=!0;const e=await H({params:p.value}),{page:y,results:q,total_pages:k,total_results:V}=e.data;_.value=y,y>1?a.value=[...a.value,...q]:a.value=q,d.value=k,l.value=V,t.value=!1,console.log(y,k),y===k?c.value=!1:c.value=!0},{deep:!0});const x=n(null),w=n(null);A(w,([{isIntersecting:h}])=>{h&&c.value&&p.value.page++},{pageViewRef:x});const D=()=>{};let L=z.timeline();const N=async()=>{L.fromTo("#search-bar, #no-result",{opacity:0},{duration:1,delay:0,opacity:1,stagger:.2})};return C(async()=>{var h,f;p.value.query=(h=r==null?void 0:r.query)==null?void 0:h.q,o.value=(f=r==null?void 0:r.query)==null?void 0:f.q,await J(),await N()}),(h,f)=>(i(),u("div",{class:"container mb-20 h-full pt-[60px]",ref_key:"pageViewRef",ref:x},[R(oe,{search:o.value,"onUpdate:search":f[0]||(f[0]=e=>o.value=e),onSearchClick:b,id:"search-bar"},null,8,["search"]),a.value.length==0||t.value?(i(),u("div",ye,[T(R(Q,null,null,512),[[O,t.value]]),a.value.length==0&&!t.value?(i(),u("p",me," 暫未搜尋到任何結果 ")):$("",!0)])):(i(),u("div",_e," 結果顯示:1-"+m(a.value.length)+" (總共"+m(l.value)+"個) ",1)),a.value.length>0?(i(),u("div",xe,[(i(!0),u(X,null,Y(a.value,(e,y)=>(i(),Z(fe,{key:y,id:e.id,title:(e==null?void 0:e.name)??e.title??(e==null?void 0:e.original_title),poster:e.poster_path,date:(e==null?void 0:e.first_air_date)??e.release_date,mediaType:e.media_type,onGetDataId:D,class:"search-card col-span-6 sm:col-span-4 md:col-span-4 lg:col-span-3 xl:col-span-2"},null,8,["id","title","poster","date","mediaType"]))),128))])):$("",!0),s("div",{ref_key:"infiniteRef",ref:w},null,512)],512))}};export{we as default};
